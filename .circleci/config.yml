#version: 2.1
#orbs:
#  node: circleci/node@3.0.0
#
#parameters:
#  run_alternative_servers:
#    type: string
#    default: ""
#
#jobs:
#  testjob:
#    docker:
#      - image: cimg/node:16.18.1
#    steps:
#      - unless:
#          condition: <<pipeline.parameters.run_alternative_servers>>
#          steps:
#            - checkout
#            - run: echo "Domyslny workflow bez podawania condition triger pipelines."
#            - run:
#                name: Install dependecies
#                command: npm install && npm install @callofduty/assets
#            - run:
#                name: Build
#                command: npm run build
#      - when:
#          condition: <<pipeline.parameters.run_alternative_servers>>
#          docker:
#            - image: cimg/node:16.19.0-browsers
#            - browser-tools/install-chrome:
#                channel: stable
#          steps:
#            - checkout
#            - run: echo "Workflow po podaniu codition pipelines triger run_alternative_servers & true."
#            - run: npm install
#            - run:
#                command: npm test
#      - run: echo "USE CircleCI parameter/ENV variable here and in next steps"
#
#workflows:
#  testworkflow:
#    jobs:
#      - hold:
#          type: approval
#          requires: [testjob]
#      - testjob:
#          filters:
#            branches:
#              only:
#                - ci-workflow
version: 2.1

workflows:
  version: 2
  build-and-test:
    jobs:
      - build:
          filters:
            branches:
              only:
                - main
      - test:
          requires:
            - build
          filters:
            branches:
              only:
                - main
          approval:
            type: approval
            requires:
              - build

jobs:
  build:
    docker:
      - image: circleci/node:latest
    steps:
      - checkout
      - run:
          name: Build
          command: npm build
        when:
          condition: << pipeline.parameters.run_build == true >>

  test:
    docker:
      - image: circleci/node:latest
    steps:
      - checkout
      - run:
          name: Test
          command: npm run test
